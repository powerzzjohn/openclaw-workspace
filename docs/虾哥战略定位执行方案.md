# 虾哥战略定位执行方案

**生效日期**：2026-02-25
**核心定位**：主对话、主要助手、主要代理
**核心任务**：① 系统安全与漏洞预警 ② 自我进化

---

## 一、系统安全与漏洞预警（每日执行）

### 1.1 心跳检查体系（已建立）

| 检查项 | 频率 | 工具/脚本 | 预警阈值 |
|--------|------|-----------|----------|
| API 限额 | 每小时 | `check_api_quota.sh` | 403错误>10次/24h |
| 飞书通道 | 每2小时 | 网关日志检查 | WebSocket断开 |
| 备份状态 | 每小时 | `auto-backup.sh` | 备份失败 |
| 模型余额 | 每天8点 | `monitor_models.sh` | 余额<¥10 |
| 系统负载 | 每天 | `daily_summary.sh` | 系统负载>80% |

### 1.2 漏洞发现与解决流程

```
发现异常 → 立即报告 → 紧急修复 → 记录根因 → 更新文档 → 固化预防机制
     ↑                                                              ↓
     └────────────────── 下次心跳检查验证 ─────────────────────────┘
```

**示例**：
- 2026-02-25 发现睡觉提醒任务失效（channel: whatsapp 不支持）
- 立即修复：改为 `delivery.mode: "none"`
- 记录根因：孤立 session 的 delivery 配置需要兼容当前通道
- 更新文档：HEARTBEAT.md 增加故障处理流程
- 固化机制：以后创建定时任务时先验证 delivery 配置

### 1.3 新增安全监控项

**需要建立的监控**：
- [ ] 飞书消息发送失败监控（今日简报、同步任务）
- [ ] Journal 导出目录完整性检查
- [ ] 子代理 session 异常监控
- [ ] 内存/磁盘空间预警

---

## 二、自我进化体系（每周+每次错误）

### 2.1 进化触发机制

**定期进化**：
- 每周一、三、五 22:00：Evolver 运行（已配置）
- 每月底：回顾本月所有漏洞，提炼模式

**事件驱动进化**：
- 每次错误/故障 → 24小时内完成根因分析
- 每次重大成功 → 提炼可复制的方法论

### 2.2 进化文档体系

| 文档 | 用途 | 更新时机 |
|------|------|----------|
| `SOUL.md` | 核心身份、价值观、战略 | 战略调整时 |
| `MEMORY.md` | 长期记忆、项目状态、写作风格 | 重要事件后 |
| `TOOLS.md` | 本地工具配置、使用经验 | 工具变更/发现问题后 |
| `HEARTBEAT.md` | 定时检查任务、故障处理 | 每次故障后 |
| `memory/YYYY-MM-DD.md` | 每日会话日志 | 每天 |

### 2.3 进化记录模板

**每次故障后必须记录**：
```markdown
## 故障记录 [日期]

**现象**：
**根因**：
**修复方案**：
**预防措施**：
**相关文档更新**：
**进化点**：
```

---

## 三、非核心任务委托策略

### 3.1 子代理分工（已建立）

| 任务类型 | 子代理 | 触发条件 |
|----------|--------|----------|
| 公众号文章撰写 | 公众号助手 | 收到"撰写第X期初稿"指令 |
| 凡人修仙代码开发 | 修仙开发助手 | 需要编写具体代码模块 |
| 工具开发 | 工具开发助手 | 需要开发新工具 |
| 始运工作分析 | 始运助手 | 每天18:00定时任务 |

### 3.2 委托决策标准

**不委托的情况**（虾哥亲自处理）：
- 涉及系统安全的任务
- 需要跨子代理协调的任务
- 首次出现的全新类型任务（先亲自做，积累经验后可能委托）

**可以委托的情况**：
- 已标准化的重复性任务
- 明确边界、有明确交付物的开发任务
- 需要长时间运行的后台任务

---

## 四、执行检查清单

### 每日（通过心跳自动检查）
- [ ] API 限额检查
- [ ] 飞书通道健康
- [ ] 备份完成状态
- [ ] 定时任务运行状态

### 每周（通过 cron 自动触发）
- [ ] 周六 22:00：Evolver 进化运行
- [ ] 周日：回顾本周所有故障记录
- [ ] 更新 MEMORY.md（如有重要事件）

### 每次会话（手动检查）
- [ ] 是否有未处理的异常/错误？
- [ ] 是否有需要固化的经验？
- [ ] 是否有需要委托给子代理的任务？

---

## 五、进化度量指标

**短期（本周）**：
- 发现并修复的漏洞数：____
- 更新的文档数：____
- 委托给子代理的任务数：____

**中期（本月）**：
- 重复发生的同类故障数（目标：逐月下降）
- 平均故障发现时间（目标：越来越短）
- 文档完整性评分（目标：新任务可直接查阅文档完成）

**长期（本季度）**：
- 系统稳定性评分（无故障运行天数）
- 自主发现漏洞占比（相对于用户报告）
- 子代理任务成功率

---

**最后更新：2026-02-25**
**状态：已生效**
