<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…«æ˜Ÿæ•°å­—æ€§æ ¼åˆ†æ Pro | æ·±åº¦ç‰ˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap');
    body { font-family: 'Noto Serif SC', serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%); min-height: 100vh; color: #e0e0e0; }
    .glass-card { background: rgba(22, 33, 62, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 215, 0, 0.2); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); }
    .star-card { background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(26, 26, 46, 0.9)); border: 1px solid rgba(255, 215, 0, 0.3); transition: all 0.3s ease; }
    .star-card:hover { transform: translateY(-5px); box-shadow: 0 10px 40px rgba(255, 215, 0, 0.2); border-color: #ffd700; }
    .btn-gradient { background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%); color: #1a1a2e; font-weight: 700; transition: all 0.3s ease; }
    .btn-gradient:hover { transform: scale(1.05); box-shadow: 0 5px 25px rgba(255, 215, 0, 0.5); }
    .tab-active { background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%); color: #1a1a2e; font-weight: 700; }
    .tab-inactive { background: rgba(22, 33, 62, 0.8); color: #e0e0e0; border: 1px solid rgba(255, 215, 0, 0.2); }
    .tab-inactive:hover { border-color: #00d9ff; color: #00d9ff; }
    .quick-fill-btn { transition: all 0.2s; }
    .quick-fill-btn:hover { transform: scale(1.05); box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
    .detail-section { border-left: 3px solid #ffd700; padding-left: 1rem; margin: 1rem 0; }
    .energy-bar { height: 8px; border-radius: 4px; background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f); }
  </style>
</head>
<body class="pb-20">
  <!-- ç™»å½•ç•Œé¢ -->
  <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
    <div class="glass-card rounded-2xl p-8 max-w-md w-full text-center">
      <div class="text-6xl mb-4">ğŸ”®</div>
      <h1 class="text-3xl font-bold text-yellow-400 mb-2">å…«æ˜Ÿæ•°å­—æ€§æ ¼åˆ†æ</h1>
      <p class="text-gray-400 mb-8">Pro æ·±åº¦ç‰ˆ - ä¸“ä¸šæ•°å­—èƒ½é‡å­¦</p>
      <div class="space-y-4">
        <input type="text" id="username-input" placeholder="è¯·è¾“å…¥æ‚¨çš„åå­—" class="w-full px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
        <button onclick="login()" class="w-full py-3 rounded-xl btn-gradient text-lg"><i class="fas fa-sign-in-alt mr-2"></i>è¿›å…¥ç³»ç»Ÿ</button>
      </div>
    </div>
  </div>

  <!-- ä¸»ç•Œé¢ -->
  <div id="main-app" class="hidden">
    <header class="glass-card sticky top-0 z-50 px-4 py-3">
      <div class="max-w-6xl mx-auto flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <span class="text-3xl">ğŸ”®</span>
          <div>
            <h1 class="text-xl font-bold text-yellow-400">å…«æ˜Ÿæ•°å­—åˆ†æ Pro</h1>
            <p class="text-xs text-gray-400">æ¬¢è¿ï¼Œ<span id="current-user">ç”¨æˆ·</span></p>
          </div>
        </div>
        <button onclick="logout()" class="px-4 py-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30"><i class="fas fa-sign-out-alt"></i></button>
      </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-6 space-y-6">
      <!-- å¿«é€Ÿå¡«å…… -->
      <div id="quick-fill-section" class="glass-card rounded-2xl p-4">
        <h3 class="text-lg font-bold text-yellow-400 mb-3"><i class="fas fa-bolt mr-2"></i>å¿«é€Ÿå¡«å……ï¼ˆç‚¹å‡»å·ç è‡ªåŠ¨å¡«å……ï¼‰</h3>
        <div id="quick-fill-list" class="flex flex-wrap gap-2"><span class="text-gray-500">æš‚æ— ä¿å­˜çš„å·ç </span></div>
      </div>

      <!-- æ¨¡å¼æ ‡ç­¾ -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
        <button onclick="switchTab('single')" id="tab-single" class="tab-active py-3 rounded-xl"><i class="fas fa-user mr-1"></i>å•äººæ·±åº¦åˆ†æ</button>
        <button onclick="switchTab('pair')" id="tab-pair" class="tab-inactive py-3 rounded-xl"><i class="fas fa-user-friends mr-1"></i>åŒäººåŒ¹é…</button>
        <button onclick="switchTab('multi')" id="tab-multi" class="tab-inactive py-3 rounded-xl"><i class="fas fa-users mr-1"></i>å¤šäººåŒ¹é…</button>
        <button onclick="switchTab('history')" id="tab-history" class="tab-inactive py-3 rounded-xl"><i class="fas fa-history mr-1"></i>å†å²è®°å½•</button>
      </div>

      <!-- å•äººåˆ†æé¢æ¿ -->
      <div id="panel-single" class="space-y-6">
        <div class="glass-card rounded-2xl p-6">
          <h2 class="text-xl font-bold text-cyan-400 mb-4"><i class="fas fa-search mr-2"></i>å•äººæ·±åº¦å·ç åˆ†æ</h2>
          <div class="flex space-x-3">
            <input type="tel" id="single-phone" placeholder="è¾“å…¥æ‰‹æœºå·ç " maxlength="13" class="flex-1 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400 text-lg">
            <button onclick="analyzeSingle()" class="px-6 py-3 rounded-xl btn-gradient"><i class="fas fa-magic mr-2"></i>æ·±åº¦åˆ†æ</button>
          </div>
          <p id="single-error" class="text-red-400 text-sm mt-2 hidden"></p>
        </div>
        <div id="single-results"></div>
      </div>

      <!-- åŒäººåŒ¹é…é¢æ¿ -->
      <div id="panel-pair" class="hidden space-y-6">
        <div class="glass-card rounded-2xl p-6">
          <h2 class="text-xl font-bold text-cyan-400 mb-4"><i class="fas fa-user-friends mr-2"></i>åŒäººæ·±åº¦åŒ¹é…åˆ†æ</h2>
          <div class="space-y-4">
            <div class="flex space-x-3">
              <input type="tel" id="pair-phone-1" placeholder="å·ç 1" maxlength="13" class="pair-phone flex-1 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
              <input type="text" id="pair-name-1" placeholder="å§“å" class="w-32 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
            </div>
            <div class="flex space-x-3">
              <input type="tel" id="pair-phone-2" placeholder="å·ç 2" maxlength="13" class="pair-phone flex-1 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
              <input type="text" id="pair-name-2" placeholder="å§“å" class="w-32 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
            </div>
          </div>
          <p id="pair-error" class="text-red-400 text-sm mt-3 hidden"></p>
          <button onclick="analyzePair()" class="w-full mt-4 py-3 rounded-xl btn-gradient text-lg"><i class="fas fa-heart mr-2"></i>å¼€å§‹æ·±åº¦åŒ¹é…åˆ†æ</button>
        </div>
        <div id="pair-results"></div>
      </div>

      <!-- å¤šäººåŒ¹é…é¢æ¿ -->
      <div id="panel-multi" class="hidden space-y-6">
        <div class="glass-card rounded-2xl p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold text-cyan-400"><i class="fas fa-users mr-2"></i>å¤šäººæ·±åº¦åŒ¹é…åˆ†æï¼ˆ3äººä»¥ä¸Šï¼‰</h2>
            <button onclick="addMultiInput()" class="px-4 py-2 rounded-lg bg-cyan-500/20 text-cyan-400 hover:bg-cyan-500/30"><i class="fas fa-plus mr-1"></i>æ·»åŠ å·ç </button>
          </div>
          <div id="multi-inputs" class="space-y-3">
            <div class="multi-row flex space-x-3">
              <input type="tel" placeholder="å·ç 1" maxlength="13" class="multi-phone flex-1 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
              <input type="text" placeholder="å§“å" class="multi-name w-32 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
            </div>
            <div class="multi-row flex space-x-3">
              <input type="tel" placeholder="å·ç 2" maxlength="13" class="multi-phone flex-1 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
              <input type="text" placeholder="å§“å" class="multi-name w-32 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
            </div>
            <div class="multi-row flex space-x-3">
              <input type="tel" placeholder="å·ç 3" maxlength="13" class="multi-phone flex-1 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
              <input type="text" placeholder="å§“å" class="multi-name w-32 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400">
            </div>
          </div>
          <p id="multi-error" class="text-red-400 text-sm mt-3 hidden"></p>
          <button onclick="analyzeMulti()" class="w-full mt-4 py-3 rounded-xl btn-gradient text-lg"><i class="fas fa-calculator mr-2"></i>å¼€å§‹å¤šäººæ·±åº¦åˆ†æ</button>
        </div>
        <div id="multi-ranking" class="hidden glass-card rounded-2xl p-6">
          <h3 class="text-xl font-bold text-yellow-400 mb-4"><i class="fas fa-trophy mr-2"></i>åŒ¹é…åº¦æ’è¡Œæ¦œ</h3>
          <div id="ranking-list" class="space-y-3"></div>
        </div>
        <div id="multi-results"></div>
      </div>

      <!-- å†å²è®°å½•é¢æ¿ -->
      <div id="panel-history" class="hidden space-y-6">
        <div class="glass-card rounded-2xl p-6">
          <h2 class="text-xl font-bold text-cyan-400 mb-4"><i class="fas fa-history mr-2"></i>å†å²åˆ†æè®°å½•</h2>
          <div id="history-list" class="space-y-3"><p class="text-gray-500 text-center py-8">æš‚æ— å†å²è®°å½•</p></div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // ==================== æ•°æ®å­˜å‚¨ ====================
    const Storage = {
      getUser() { return localStorage.getItem('bx_user'); },
      setUser(name) { localStorage.setItem('bx_user', name); },
      getPhones() { const d = localStorage.getItem('bx_phones_' + this.getUser()); return d ? JSON.parse(d) : []; },
      savePhone(phone, name) {
        const phones = this.getPhones();
        if (!phones.find(p => p.phone === phone)) {
          phones.push({ phone, name: name || '', date: new Date().toISOString() });
          localStorage.setItem('bx_phones_' + this.getUser(), JSON.stringify(phones));
        }
      },
      getHistory() { const d = localStorage.getItem('bx_history_' + this.getUser()); return d ? JSON.parse(d) : []; },
      saveHistory(r) { const h = this.getHistory(); h.unshift({ ...r, date: new Date().toISOString() }); if (h.length > 50) h.pop(); localStorage.setItem('bx_history_' + this.getUser(), JSON.stringify(h)); }
    };

    // ==================== å…«æ˜Ÿæ•°æ®ï¼ˆå®Œæ•´ç‰ˆï¼‰ ====================
    const starMap = {
      '11':'ä¼ä½','22':'ä¼ä½','33':'ä¼ä½','44':'ä¼ä½','66':'ä¼ä½','77':'ä¼ä½','88':'ä¼ä½','99':'ä¼ä½',
      '14':'ç”Ÿæ°”','41':'ç”Ÿæ°”','67':'ç”Ÿæ°”','76':'ç”Ÿæ°”','39':'ç”Ÿæ°”','93':'ç”Ÿæ°”','28':'ç”Ÿæ°”','82':'ç”Ÿæ°”',
      '19':'å»¶å¹´','91':'å»¶å¹´','78':'å»¶å¹´','87':'å»¶å¹´','34':'å»¶å¹´','43':'å»¶å¹´','26':'å»¶å¹´','62':'å»¶å¹´',
      '13':'å¤©åŒ»','31':'å¤©åŒ»','68':'å¤©åŒ»','86':'å¤©åŒ»','49':'å¤©åŒ»','94':'å¤©åŒ»','27':'å¤©åŒ»','72':'å¤©åŒ»',
      '16':'å…­ç…','61':'å…­ç…','47':'å…­ç…','74':'å…­ç…','38':'å…­ç…','83':'å…­ç…','29':'å…­ç…','92':'å…­ç…',
      '17':'ç¥¸å®³','71':'ç¥¸å®³','89':'ç¥¸å®³','98':'ç¥¸å®³','46':'ç¥¸å®³','64':'ç¥¸å®³','23':'ç¥¸å®³','32':'ç¥¸å®³',
      '18':'äº”é¬¼','81':'äº”é¬¼','79':'äº”é¬¼','97':'äº”é¬¼','36':'äº”é¬¼','63':'äº”é¬¼','24':'äº”é¬¼','42':'äº”é¬¼',
      '12':'ç»å‘½','21':'ç»å‘½','69':'ç»å‘½','96':'ç»å‘½','48':'ç»å‘½','84':'ç»å‘½','37':'ç»å‘½','73':'ç»å‘½',
    };

    // è¯¦ç»†çš„å…«æ˜Ÿä¿¡æ¯
    const starDetails = {
      'ä¼ä½': {
        icon: 'ğŸ”ï¸', trait: 'ä¿å®ˆç¨³é‡', element: 'åœŸ', direction: 'åŒ—',
        desc: 'ä¼ä½ä»£è¡¨ç¨³å›ºã€ä¿å®ˆã€æŒä¹…çš„èƒ½é‡ã€‚æ‹¥æœ‰ä¼ä½èƒ½é‡çš„äººåšäº‹è°¨æ…ï¼Œä¸è½»æ˜“æ”¹å˜ï¼Œæœ‰è€å¿ƒæŒä¹…åŠ›ã€‚',
        strengths: ['è€å¿ƒæŒä¹…', 'ç¨³é‡å¯é ', 'å–„äºå®ˆæˆ', 'ç»†æ°´é•¿æµ'],
        weaknesses: ['è¿‡äºä¿å®ˆ', 'å›ºæ‰§å·±è§', 'ç¼ºä¹å˜é€š', 'é”™å¤±è‰¯æœº'],
        career: ['ä¼šè®¡å¸ˆ', 'å®¡è®¡å¸ˆ', 'ç ”ç©¶å‘˜', 'æ¡£æ¡ˆç®¡ç†', 'å›¾ä¹¦ç®¡ç†å‘˜', 'ä»“åº“ç®¡ç†'],
        wealth: 'æ­£è´¢ä¸ºä¸»ï¼Œä¸å®œæŠ•æœºï¼Œç¨³å¥ç†è´¢',
        relationship: 'æ„Ÿæƒ…ç¨³å®šä½†è¢«åŠ¨ï¼Œéœ€è¦æ—¶é—´å»ºç«‹ä¿¡ä»»',
        health: 'æ³¨æ„è„¾èƒƒæ¶ˆåŒ–ç³»ç»Ÿ',
        advice: 'åœ¨ä¿æŒç¨³å¥çš„åŒæ—¶ï¼Œé€‚å½“å°è¯•æ–°äº‹ç‰©ï¼ŒåŸ¹å…»å¼€æ”¾å¿ƒæ€ã€‚'
      },
      'ç”Ÿæ°”': {
        icon: 'ğŸŒŸ', trait: 'è´µäººè¿ä½³', element: 'æœ¨', direction: 'ä¸œ',
        desc: 'ç”Ÿæ°”ä»£è¡¨è´µäººã€éšç¼˜ã€ä¹è§‚çš„èƒ½é‡ã€‚æ‹¥æœ‰ç”Ÿæ°”èƒ½é‡çš„äººäººç¼˜å¥½ï¼Œå¸¸æœ‰è´µäººç›¸åŠ©ï¼Œå¿ƒæ€ä¹è§‚éšç¼˜ã€‚',
        strengths: ['è´µäººè¿å¼º', 'ä¹è§‚å¼€æœ—', 'äººç¼˜æä½³', 'éšé‡è€Œå®‰'],
        weaknesses: ['è¿‡äºéšç¼˜', 'ç¼ºä¹ä¸»è§', 'å®¹æ˜“æ»¡è¶³', 'ä¸Šè¿›å¿ƒä¸è¶³'],
        career: ['å…¬å…³', 'é”€å”®', 'å®¢æœ', 'äººåŠ›èµ„æº', 'æ•™è‚²åŸ¹è®­', 'å’¨è¯¢é¡¾é—®'],
        wealth: 'è´µäººå¸¦æ¥è´¢è¿ï¼Œé€‚åˆåˆä¼™ç»è¥',
        relationship: 'å¼‚æ€§ç¼˜å¥½ï¼Œä½†æ„Ÿæƒ…è¾ƒä¸ºéšæ„',
        health: 'æ³¨æ„è‚èƒ†ç³»ç»Ÿ',
        advice: 'çæƒœè´µäººç¼˜ï¼ŒåŒæ—¶åŸ¹å…»è‡ªå·±çš„ä¸»è§å’Œç›®æ ‡æ„Ÿã€‚'
      },
      'å»¶å¹´': {
        icon: 'ğŸ‘‘', trait: 'é¢†å¯¼èƒ½åŠ›', element: 'é‡‘', direction: 'è¥¿',
        desc: 'å»¶å¹´ä»£è¡¨èƒ½åŠ›ã€è´£ä»»ã€é¢†å¯¼çš„èƒ½é‡ã€‚æ‹¥æœ‰å»¶å¹´èƒ½é‡çš„äººèƒ½åŠ›å¼ºï¼Œè´£ä»»å¿ƒé‡ï¼Œå…·æœ‰é¢†å¯¼æ°”è´¨ã€‚',
        strengths: ['èƒ½åŠ›å¼º', 'è´£ä»»å¿ƒé‡', 'é¢†å¯¼æ°”è´¨', 'ä¸“ä¸šä¸“æ³¨'],
        weaknesses: ['å‹åŠ›è¿‡å¤§', 'å›ºæ‰§å¼ºåŠ¿', 'ä¸å–„æ”¾æ¾', 'å®¹æ˜“åŠ³ç´¯'],
        career: ['ç®¡ç†è€…', 'é¢†å¯¼è€…', 'ä¸“ä¸šäººå£«', 'å·¥ç¨‹å¸ˆ', 'åŒ»ç”Ÿ', 'å¾‹å¸ˆ'],
        wealth: 'å‡­å®åŠ›èµšé’±ï¼Œæ­£è´¢ç¨³å®š',
        relationship: 'æ„Ÿæƒ…ä¸Šè¾ƒå¼ºåŠ¿ï¼Œéœ€è¦å­¦ä¼šæŸ”è½¯',
        health: 'æ³¨æ„å¿ƒè„å’Œè‚©é¢ˆ',
        advice: 'å­¦ä¼šæ”¾æƒï¼Œé€‚å½“æ”¾æ¾ï¼Œå¹³è¡¡å·¥ä½œä¸ç”Ÿæ´»ã€‚'
      },
      'å¤©åŒ»': {
        icon: 'ğŸ’', trait: 'è´¢å¯Œæ™ºæ…§', element: 'åœŸ', direction: 'ä¸­',
        desc: 'å¤©åŒ»ä»£è¡¨è´¢å¯Œã€æ™ºæ…§ã€æ­£æ¡ƒèŠ±çš„èƒ½é‡ã€‚æ‹¥æœ‰å¤©åŒ»èƒ½é‡çš„äººèªæ˜æœ‰æ™ºæ…§ï¼Œæ­£è´¢æ—ºï¼Œå©šå§»æ„Ÿæƒ…å¥½ã€‚',
        strengths: ['èªæ˜æ™ºæ…§', 'æ­£è´¢æ—ºç››', 'å©šå§»ç¾æ»¡', 'å¿ƒåœ°å–„è‰¯'],
        weaknesses: ['è¿‡äºå–„è‰¯', 'å®¹æ˜“å—éª—', 'è¿½æ±‚å®Œç¾', 'å‹åŠ›è¾ƒå¤§'],
        career: ['é‡‘è', 'æŠ•èµ„', 'æ•™è‚²', 'åŒ»ç–—', 'è‰ºæœ¯', 'ç§‘ç ”'],
        wealth: 'æ­£è´¢åè´¢çš†æ—ºï¼ŒæŠ•èµ„çœ¼å…‰å‡†',
        relationship: 'æ­£æ¡ƒèŠ±æ—ºï¼Œå©šå§»å¹¸ç¦ç¾æ»¡',
        health: 'æ³¨æ„è¡€å‹å’Œçœ¼éƒ¨',
        advice: 'ä¿æŒå–„è‰¯çš„åŒæ—¶ï¼Œå­¦ä¼šä¿æŠ¤è‡ªå·±ï¼Œç†æ€§å†³ç­–ã€‚'
      },
      'å…­ç…': {
        icon: 'ğŸŒ¸', trait: 'æƒ…æ„Ÿä¸°å¯Œ', element: 'æ°´', direction: 'åŒ—',
        desc: 'å…­ç…ä»£è¡¨æƒ…æ„Ÿã€å¼‚æ€§ç¼˜ã€çº ç»“çš„èƒ½é‡ã€‚æ‹¥æœ‰å…­ç…èƒ½é‡çš„äººæƒ…æ„Ÿä¸°å¯Œï¼Œå¼‚æ€§ç¼˜å¥½ï¼Œä½†å®¹æ˜“çº ç»“ã€‚',
        strengths: ['æƒ…æ„Ÿä¸°å¯Œ', 'å¼‚æ€§ç¼˜ä½³', 'è‰ºæœ¯å¤©èµ‹', 'ç›´è§‰æ•é”'],
        weaknesses: ['æƒ…æ„Ÿçº ç»“', 'ä¼˜æŸ”å¯¡æ–­', 'æ¡ƒèŠ±åŠ«å¤š', 'æƒ…ç»ªæ³¢åŠ¨'],
        career: ['è‰ºæœ¯', 'è®¾è®¡', 'æ¼”è‰º', 'ç¾å®¹', 'æ—¶å°š', 'å¿ƒç†å’¨è¯¢'],
        wealth: 'é äººé™…å…³ç³»èµšé’±ï¼Œæ³¨æ„æ¡ƒèŠ±ç ´è´¢',
        relationship: 'å¼‚æ€§ç¼˜æå¥½ï¼Œä½†æ„Ÿæƒ…å¤æ‚å¤šå˜',
        health: 'æ³¨æ„è‚¾æ³Œå°¿ç³»ç»Ÿå’Œçš®è‚¤',
        advice: 'ç†æ€§å¤„ç†æ„Ÿæƒ…ï¼ŒåŸ¹å…»å†³æ–­åŠ›ï¼Œè¿œç¦»çƒ‚æ¡ƒèŠ±ã€‚'
      },
      'ç¥¸å®³': {
        icon: 'ğŸ’¬', trait: 'å£æ‰è¡¨è¾¾', element: 'åœŸ', direction: 'è¥¿å—',
        desc: 'ç¥¸å®³ä»£è¡¨å£æ‰ã€è¡¨è¾¾ã€æ˜¯éçš„èƒ½é‡ã€‚æ‹¥æœ‰ç¥¸å®³èƒ½é‡çš„äººå£æ‰å¥½ï¼Œçˆ±é¢å­ï¼Œä½†ä¹Ÿå®¹æ˜“æ‹›æƒ¹æ˜¯éã€‚',
        strengths: ['å£æ‰æä½³', 'è¡¨è¾¾èƒ½åŠ›å¼º', 'å–„äºè¾©è®º', 'é¢å­è§‚å¿µå¼º'],
        weaknesses: ['å£èˆŒæ˜¯é', 'çˆ±é¢å­', 'è¨€å¤šå¿…å¤±', 'å®¹æ˜“å¾—ç½ªäºº'],
        career: ['ä¸»æŒäºº', 'å¾‹å¸ˆ', 'é”€å”®', 'åŸ¹è®­å¸ˆ', 'ä½œå®¶', 'è®°è€…'],
        wealth: 'é å£æ‰èµšé’±ï¼Œæ³¨æ„å£èˆŒç ´è´¢',
        relationship: 'èƒ½è¨€å–„é“ä½†æ˜“æœ‰å£èˆŒä¹‹äº‰',
        health: 'æ³¨æ„å£è…”å’Œå‘¼å¸ç³»ç»Ÿ',
        advice: 'æ…è¨€æ…è¡Œï¼Œå­¦ä¼šå€¾å¬ï¼Œé¿å…ä¸å¿…è¦çš„äº‰è®ºã€‚'
      },
      'äº”é¬¼': {
        icon: 'ğŸ”®', trait: 'æ‰åæ¨ªæº¢', element: 'ç«', direction: 'å—',
        desc: 'äº”é¬¼ä»£è¡¨æ‰åã€å˜åŒ–ã€çµå¼‚çš„èƒ½é‡ã€‚æ‹¥æœ‰äº”é¬¼èƒ½é‡çš„äººæ‰åæ¨ªæº¢ï¼Œæ€ç»´æ´»è·ƒï¼Œä½†å˜åŒ–å¤šç«¯ã€‚',
        strengths: ['æ‰åæ¨ªæº¢', 'æ€ç»´æ´»è·ƒ', 'åˆ›æ„æ— é™', 'ç›´è§‰è¶…å¼º'],
        weaknesses: ['å˜åŒ–æ— å¸¸', 'æƒ…ç»ªä¸ç¨³', 'å¤±çœ å¤šæ¢¦', 'ç–‘å¿ƒè¾ƒé‡'],
        career: ['åˆ›æ„', 'ç­–åˆ’', 'IT', 'ç„å­¦', 'è‰ºæœ¯', 'ä¾¦æ¢'],
        wealth: 'åè´¢æ—ºï¼Œæ„å¤–ä¹‹è´¢ï¼Œä½†ä¸ç¨³å®š',
        relationship: 'æ„Ÿæƒ…å˜åŒ–å¿«ï¼Œéš¾ä»¥æ‰æ‘¸',
        health: 'æ³¨æ„å¿ƒè„å’Œç¡çœ ',
        advice: 'åŸ¹å…»ä¸“æ³¨åŠ›ï¼Œç¨³å®šæƒ…ç»ªï¼Œå–„ç”¨æ‰åäºæ­£é“ã€‚'
      },
      'ç»å‘½': {
        icon: 'âš¡', trait: 'æŠ•èµ„å†’é™©', element: 'é‡‘', direction: 'è¥¿åŒ—',
        desc: 'ç»å‘½ä»£è¡¨æŠ•èµ„ã€å†²åŠ¨ã€æç«¯çš„èƒ½é‡ã€‚æ‹¥æœ‰ç»å‘½èƒ½é‡çš„äººæ•¢å†’é™©ï¼Œè¡ŒåŠ¨åŠ›å¼ºï¼Œä½†å®¹æ˜“èµ°æç«¯ã€‚',
        strengths: ['æ•¢å†’é™©', 'è¡ŒåŠ¨åŠ›å¼º', 'æŠ•èµ„çœ¼å…‰', 'ç»åœ°åå‡»'],
        weaknesses: ['å†²åŠ¨é²è½', 'æç«¯è¡Œä¸º', 'å¤§èµ·å¤§è½', 'æ˜“èµ°åé—¨'],
        career: ['æŠ•èµ„', 'åˆ›ä¸š', 'é”€å”®', 'å†›è­¦', 'è¿åŠ¨å‘˜', 'æ¢é™©'],
        wealth: 'å¤§èµ·å¤§è½ï¼Œæš´åˆ©ä¸é£é™©å¹¶å­˜',
        relationship: 'çˆ±æ¨åˆ†æ˜ï¼Œæ„Ÿæƒ…æç«¯',
        health: 'æ³¨æ„è‚è‚¾å’Œæ„å¤–ä¼¤',
        advice: 'æ§åˆ¶é£é™©ï¼Œé‡åŠ›è€Œè¡Œï¼Œé¿å…å­¤æ³¨ä¸€æ·ã€‚'
      },
      'æœªçŸ¥': {
        icon: 'â“', trait: 'ç‰¹æ®Šèƒ½é‡', element: 'æœªçŸ¥', direction: 'æœªçŸ¥',
        desc: 'æ­¤å·ç åŒ…å«ç‰¹æ®Šçš„æ•°å­—ç»„åˆï¼Œä¸åœ¨ä¼ ç»Ÿå…«æ˜Ÿæ•°å­—èƒ½é‡å­¦ä½“ç³»ä¸­ï¼Œå±äºç‰¹æ®Šçš„èƒ½é‡ç±»å‹ã€‚',
        strengths: ['ç‹¬ç‰¹æ€§', 'ä¸ä¼—ä¸åŒ', 'æ½œåœ¨å¯èƒ½'],
        weaknesses: ['éš¾ä»¥å½’ç±»', 'ä¸æ˜“è§£è¯»', 'èƒ½é‡ä¸ç¨³'],
        career: ['è‡ªç”±èŒä¸š', 'æ–°å…´è¡Œä¸š', 'è·¨ç•Œé¢†åŸŸ'],
        wealth: 'éœ€è¦å…·ä½“åˆ†æï¼Œå¯èƒ½æœ‰æ„æƒ³ä¸åˆ°çš„è´¢è¿',
        relationship: 'ç‹¬ç‰¹é­…åŠ›ï¼Œä½†ä¸æ˜“ç†è§£',
        health: 'æ³¨æ„å…¨é¢ä½“æ£€',
        advice: 'ä¿æŒå¼€æ”¾å¿ƒæ€ï¼Œå‘æŒ¥ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œèµ°å‡ºè‡ªå·±çš„è·¯ã€‚'
      }
    };

    // ==================== ç”¨æˆ·ç³»ç»Ÿ ====================
    function login() {
      const u = document.getElementById('username-input').value.trim();
      if (!u) { alert('è¯·è¾“å…¥æ‚¨çš„åå­—'); return; }
      Storage.setUser(u);
      document.getElementById('current-user').textContent = u;
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-app').classList.remove('hidden');
      loadQuickFill();
      loadHistory();
    }
    function logout() {
      if (confirm('ç¡®å®šé€€å‡ºï¼Ÿ')) {
        document.getElementById('main-app').classList.add('hidden');
        document.getElementById('login-screen').classList.remove('hidden');
        document.getElementById('username-input').value = '';
      }
    }
    if (Storage.getUser()) {
      document.getElementById('current-user').textContent = Storage.getUser();
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-app').classList.remove('hidden');
      loadQuickFill();
      loadHistory();
    }

    // ==================== å¿«é€Ÿå¡«å…… ====================
    function loadQuickFill() {
      const phones = Storage.getPhones();
      const container = document.getElementById('quick-fill-list');
      if (phones.length === 0) { container.innerHTML = '<span class="text-gray-500">æš‚æ— ä¿å­˜çš„å·ç </span>'; return; }
      container.innerHTML = phones.map(p => `<button onclick="fillPhone('${p.phone}')" class="quick-fill-btn px-3 py-2 rounded-lg bg-gray-800 border border-yellow-500/50 text-yellow-400 text-sm">${p.name ? p.name + ' ' : ''}${p.phone.slice(-4)}</button>`).join('');
    }
    function fillPhone(phone) {
      const activePanel = document.querySelector('[id^="panel-"]:not(.hidden)');
      if (!activePanel) return;
      const panelId = activePanel.id;
      if (panelId === 'panel-single') document.getElementById('single-phone').value = phone;
      else if (panelId === 'panel-pair') {
        const p1 = document.getElementById('pair-phone-1').value;
        const p2 = document.getElementById('pair-phone-2').value;
        if (!p1) document.getElementById('pair-phone-1').value = phone;
        else if (!p2) document.getElementById('pair-phone-2').value = phone;
        else document.getElementById('pair-phone-1').value = phone;
      } else if (panelId === 'panel-multi') {
        const inputs = document.querySelectorAll('.multi-phone');
        for (let input of inputs) if (!input.value) { input.value = phone; break; }
      }
    }

    // ==================== æ ¸å¿ƒç®—æ³• ====================
    function extractGroups(phone) {
      const digits = phone.replace(/\D/g, '');
      const last8 = digits.slice(-8);
      const groups = [];
      for (let i = 0; i < last8.length; i += 2) groups.push(last8.slice(i, i + 2));
      return groups;
    }
    function analyzeDistribution(groups) {
      const dist = {};
      groups.forEach(g => { const star = starMap[g] || 'æœªçŸ¥'; dist[star] = (dist[star] || 0) + 1; });
      return dist;
    }
    function calcScore(dist1, dist2) {
      let score = 50;
      const stars = [...new Set([...Object.keys(dist1), ...Object.keys(dist2)])].filter(s => s !== 'æœªçŸ¥');
      stars.forEach(star => { const c1 = dist1[star] || 0; const c2 = dist2[star] || 0; if (c1 > 0 && c2 > 0) score += 10; });
      const comp = { 'å¤©åŒ»': ['ç”Ÿæ°”', 'å»¶å¹´'], 'ç”Ÿæ°”': ['å¤©åŒ»', 'å»¶å¹´'], 'å»¶å¹´': ['å¤©åŒ»', 'ç”Ÿæ°”'] };
      Object.keys(comp).forEach(s1 => { comp[s1].forEach(s2 => { if ((dist1[s1] && dist2[s2]) || (dist1[s2] && dist2[s1])) score += 15; }); });
      return Math.min(100, Math.max(20, score));
    }
    function getScoreLevel(s) { if (s >= 90) return 'å¤©ä½œä¹‹åˆ âœ¨'; if (s >= 80) return 'éå¸¸èˆ¬é… ğŸ’•'; if (s >= 70) return 'äº’è¡¥å…±èµ¢ ğŸ¤'; if (s >= 60) return 'éœ€è¦ç£¨åˆ ğŸ’«'; return 'æŒ‘æˆ˜æˆé•¿ ğŸŒ±'; }
    function getScoreColor(s) { if (s >= 80) return '#6bcf7f'; if (s >= 60) return '#ffd93d'; return '#ff6b6b'; }

    // ==================== å•äººæ·±åº¦åˆ†æ ====================
    function analyzeSingle() {
      const phone = document.getElementById('single-phone').value.trim().replace(/\D/g, '');
      const errorEl = document.getElementById('single-error');
      if (!/^1[3-9]\d{9}$/.test(phone)) { errorEl.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„11ä½æ‰‹æœºå·ç '; errorEl.classList.remove('hidden'); return; }
      errorEl.classList.add('hidden');
      Storage.savePhone(phone, '');
      loadQuickFill();
      
      const groups = extractGroups(phone);
      const dist = analyzeDistribution(groups);
      const sortedEntries = Object.entries(dist).sort((a, b) => { if (a[0] === 'æœªçŸ¥') return 1; if (b[0] === 'æœªçŸ¥') return -1; return b[1] - a[1]; });
      const dominant = sortedEntries[0];
      const detail = starDetails[dominant[0]];
      
      // ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
      const div = document.createElement('div');
      div.className = 'glass-card rounded-2xl p-6 mt-4';
      div.innerHTML = `
        <div class="flex justify-between items-start mb-4">
          <h3 class="text-2xl font-bold text-yellow-400">${phone.slice(0, 3)}****${phone.slice(-4)} æ·±åº¦åˆ†ææŠ¥å‘Š</h3>
          <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-red-400 text-xl">âœ•</button>
        </div>
        
        <!-- ä¸»å¯¼èƒ½é‡ -->
        <div class="text-center mb-6 p-4 bg-gradient-to-r from-yellow-500/20 to-cyan-500/20 rounded-xl">
          <div class="text-6xl mb-2">${detail.icon}</div>
          <div class="text-3xl font-bold text-yellow-400">${dominant[0]}</div>
          <div class="text-xl text-cyan-400">${detail.trait}</div>
          <div class="text-sm text-gray-400 mt-1">äº”è¡Œï¼š${detail.element} | æ–¹ä½ï¼š${detail.direction}</div>
        </div>
        
        <!-- èƒ½é‡åˆ†å¸ƒ -->
        <div class="mb-6">
          <h4 class="font-bold text-yellow-400 mb-3"><i class="fas fa-chart-pie mr-2"></i>å…«æ˜Ÿèƒ½é‡åˆ†å¸ƒ</h4>
          <div class="grid grid-cols-4 gap-2">
            ${sortedEntries.map(([star, count]) => {
              const s = starDetails[star];
              return `<div class="${star === 'æœªçŸ¥' ? 'bg-gray-700/50' : 'bg-gray-800'} rounded-lg p-3 text-center">
                <div class="text-2xl mb-1">${s.icon}</div>
                <div class="text-sm font-bold ${star === 'æœªçŸ¥' ? 'text-gray-500' : 'text-yellow-400'}">${star}</div>
                <div class="text-xs text-gray-400">${count}ç»„</div>
                <div class="mt-1 h-1 bg-gray-700 rounded-full"><div class="h-full bg-yellow-400 rounded-full" style="width: ${(count/4)*100}%"></div></div>
              </div>`;
            }).join('')}
          </div>
          <div class="mt-2 text-sm text-gray-400">åŸå§‹æ•°å­—ç»„åˆï¼š${groups.join(' | ')}</div>
        </div>
        
        <!-- æ ¸å¿ƒç‰¹è´¨ -->
        <div class="detail-section mb-4">
          <h4 class="font-bold text-cyan-400 mb-2"><i class="fas fa-star mr-2"></i>æ ¸å¿ƒç‰¹è´¨</h4>
          <p class="text-gray-300 leading-relaxed">${detail.desc}</p>
        </div>
        
        <!-- ä¼˜åŠ¿ä¸åŠ£åŠ¿ -->
        <div class="grid md:grid-cols-2 gap-4 mb-4">
          <div class="bg-green-900/30 rounded-xl p-4">
            <h5 class="font-bold text-green-400 mb-2"><i class="fas fa-thumbs-up mr-2"></i>æ ¸å¿ƒä¼˜åŠ¿</h5>
            <ul class="text-sm text-gray-300 space-y-1">
              ${detail.strengths.map(s => `<li>â€¢ ${s}</li>`).join('')}
            </ul>
          </div>
          <div class="bg-red-900/30 rounded-xl p-4">
            <h5 class="font-bold text-red-400 mb-2"><i class="fas fa-exclamation-triangle mr-2"></i>éœ€è¦æ³¨æ„</h5>
            <ul class="text-sm text-gray-300 space-y-1">
              ${detail.weaknesses.map(w => `<li>â€¢ ${w}</li>`).join('')}
            </ul>
          </div>
        </div>
        
        <!-- äº‹ä¸šä¸è´¢å¯Œ -->
        <div class="grid md:grid-cols-2 gap-4 mb-4">
          <div class="detail-section">
            <h5 class="font-bold text-cyan-400 mb-2"><i class="fas fa-briefcase mr-2"></i>é€‚åˆèŒä¸š</h5>
            <p class="text-sm text-gray-300">${detail.career.join('ã€')}</p>
          </div>
          <div class="detail-section">
            <h5 class="font-bold text-cyan-400 mb-2"><i class="fas fa-coins mr-2"></i>è´¢å¯Œå»ºè®®</h5>
            <p class="text-sm text-gray-300">${detail.wealth}</p>
          </div>
        </div>
        
        <!-- æ„Ÿæƒ…ä¸å¥åº· -->
        <div class="grid md:grid-cols-2 gap-4 mb-4">
          <div class="detail-section">
            <h5 class="font-bold text-pink-400 mb-2"><i class="fas fa-heart mr-2"></i>æ„Ÿæƒ…è¿åŠ¿</h5>
            <p class="text-sm text-gray-300">${detail.relationship}</p>
          </div>
          <div class="detail-section">
            <h5 class="font-bold text-green-400 mb-2"><i class="fas fa-heartbeat mr-2"></i>å¥åº·æé†’</h5>
            <p class="text-sm text-gray-300">${detail.health}</p>
          </div>
        </div>
        
        <!-- ä¸“å±å»ºè®® -->
        <div class="bg-yellow-500/10 rounded-xl p-4 border border-yellow-500/30">
          <h5 class="font-bold text-yellow-400 mb-2"><i class="fas fa-lightbulb mr-2"></i>ä¸“å±å‘å±•å»ºè®®</h5>
          <p class="text-gray-300">${detail.advice}</p>
        </div>
      `;
      document.getElementById('single-results').prepend(div);
      Storage.saveHistory({ type: 'single', phone, result: dominant[0] });
      document.getElementById('single-phone').value = '';
    }

    // ==================== åŒäººæ·±åº¦åŒ¹é… ====================
    function analyzePair() {
      const p1 = document.getElementById('pair-phone-1').value.trim().replace(/\D/g, '');
      const p2 = document.getElementById('pair-phone-2').value.trim().replace(/\D/g, '');
      const n1 = document.getElementById('pair-name-1').value.trim() || 'ç”¨æˆ·A';
      const n2 = document.getElementById('pair-name-2').value.trim() || 'ç”¨æˆ·B';
      const errorEl = document.getElementById('pair-error');
      
      if (!/^1[3-9]\d{9}$/.test(p1) || !/^1[3-9]\d{9}$/.test(p2)) { errorEl.textContent = 'è¯·è¾“å…¥ä¸¤ä¸ªæœ‰æ•ˆçš„11ä½æ‰‹æœºå·ç '; errorEl.classList.remove('hidden'); return; }
      if (p1 === p2) { errorEl.textContent = 'è¯·è¾“å…¥ä¸¤ä¸ªä¸åŒçš„å·ç '; errorEl.classList.remove('hidden'); return; }
      errorEl.classList.add('hidden');
      Storage.savePhone(p1, n1); Storage.savePhone(p2, n2); loadQuickFill();
      
      const groups1 = extractGroups(p1), groups2 = extractGroups(p2);
      const dist1 = analyzeDistribution(groups1), dist2 = analyzeDistribution(groups2);
      const score = calcScore(dist1, dist2);
      
      // åˆ†æåŒæ–¹ä¸»å¯¼æ˜Ÿ
      const dom1 = Object.entries(dist1).filter(x => x[0] !== 'æœªçŸ¥').sort((a,b) => b[1]-a[1])[0];
      const dom2 = Object.entries(dist2).filter(x => x[0] !== 'æœªçŸ¥').sort((a,b) => b[1]-a[1])[0];
      const detail1 = dom1 ? starDetails[dom1[0]] : starDetails['æœªçŸ¥'];
      const detail2 = dom2 ? starDetails[dom2[0]] : starDetails['æœªçŸ¥'];
      
      // äº’è¡¥æ€§åˆ†æ
      let complementAnalysis = '';
      const compPairs = [['å¤©åŒ»','ç”Ÿæ°”'], ['å¤©åŒ»','å»¶å¹´'], ['ç”Ÿæ°”','å»¶å¹´']];
      const hasComp = compPairs.some(([s1,s2]) => (dist1[s1] && dist2[s2]) || (dist1[s2] && dist2[s1]));
      if (hasComp) complementAnalysis = '<span class="text-green-400">âœ“ åŒæ–¹å­˜åœ¨è‰¯å¥½çš„èƒ½é‡äº’è¡¥å…³ç³»</span>';
      else if (dom1 && dom2 && dom1[0] === dom2[0]) complementAnalysis = '<span class="text-yellow-400">! åŒæ–¹ä¸»å¯¼èƒ½é‡ç›¸åŒï¼Œå¿—åŒé“åˆä½†ä¹Ÿå¯èƒ½äº’ä¸ç›¸è®©</span>';
      else complementAnalysis = '<span class="text-cyan-400">~ åŒæ–¹èƒ½é‡ç±»å‹ä¸åŒï¼Œéœ€è¦ç›¸äº’ç†è§£å’ŒåŒ…å®¹</span>';
      
      const div = document.createElement('div');
      div.className = 'glass-card rounded-2xl p-6 mt-4';
      div.innerHTML = `
        <div class="flex justify-between items-start mb-4">
          <h3 class="text-2xl font-bold text-yellow-400">åŒäººæ·±åº¦åŒ¹é…æŠ¥å‘Š</h3>
          <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-red-400 text-xl">âœ•</button>
        </div>
        
        <!-- åŒ¹é…åº¦æ€»è§ˆ -->
        <div class="text-center mb-6 p-6 bg-gradient-to-r from-yellow-500/20 via-pink-500/20 to-cyan-500/20 rounded-xl">
          <div class="flex justify-center items-center space-x-6 mb-4">
            <div class="text-center">
              <div class="text-4xl">${detail1.icon}</div>
              <div class="font-bold">${n1}</div>
              <div class="text-sm text-gray-400">${dom1 ? dom1[0] : 'ç‰¹æ®Š'}</div>
            </div>
            <div class="text-5xl text-yellow-400">Ã—</div>
            <div class="text-center">
              <div class="text-4xl">${detail2.icon}</div>
              <div class="font-bold">${n2}</div>
              <div class="text-sm text-gray-400">${dom2 ? dom2[0] : 'ç‰¹æ®Š'}</div>
            </div>
          </div>
          <div class="text-7xl font-bold" style="color: ${getScoreColor(score)}">${score}åˆ†</div>
          <div class="text-2xl mt-2">${getScoreLevel(score)}</div>
          <div class="mt-2">${complementAnalysis}</div>
        </div>
        
        <!-- èƒ½é‡å¯¹æ¯” -->
        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div class="bg-gray-800/50 rounded-xl p-4">
            <h4 class="font-bold text-cyan-400 mb-3">${n1} èƒ½é‡åˆ†æ</h4>
            <div class="space-y-2 text-sm">
              ${Object.entries(dist1).filter(x => x[0] !== 'æœªçŸ¥').map(([s,c]) => `<div class="flex justify-between"><span>${starDetails[s].icon} ${s}</span><span class="text-yellow-400">${c}ç»„</span></div>`).join('')}
            </div>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <p class="text-xs text-gray-400">${detail1.desc.substring(0, 50)}...</p>
            </div>
          </div>
          <div class="bg-gray-800/50 rounded-xl p-4">
            <h4 class="font-bold text-cyan-400 mb-3">${n2} èƒ½é‡åˆ†æ</h4>
            <div class="space-y-2 text-sm">
              ${Object.entries(dist2).filter(x => x[0] !== 'æœªçŸ¥').map(([s,c]) => `<div class="flex justify-between"><span>${starDetails[s].icon} ${s}</span><span class="text-yellow-400">${c}ç»„</span></div>`).join('')}
            </div>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <p class="text-xs text-gray-400">${detail2.desc.substring(0, 50)}...</p>
            </div>
          </div>
        </div>
        
        <!-- æ·±åº¦åˆ†æ -->
        <div class="space-y-4">
          <div class="detail-section">
            <h4 class="font-bold text-yellow-400 mb-2"><i class="fas fa-heart mr-2"></i>æ„Ÿæƒ…åŒ¹é…åˆ†æ</h4>
            <p class="text-gray-300 text-sm leading-relaxed">
              ${n1}ï¼ˆ${detail1.trait}ï¼‰ä¸ ${n2}ï¼ˆ${detail2.trait}ï¼‰çš„ç»„åˆï¼Œ${score >= 80 ? 'èƒ½é‡é«˜åº¦å¥‘åˆï¼Œæ„Ÿæƒ…å‘å±•é¡ºåˆ©ï¼Œå½¼æ­¤èƒ½å¤Ÿç›¸äº’æ”¯æŒå’Œç†è§£ã€‚' : score >= 60 ? 'æœ‰ä¸€å®šçš„äº’è¡¥æ€§ï¼Œéœ€è¦åŒæ–¹å…±åŒåŠªåŠ›ç»è¥æ„Ÿæƒ…ã€‚' : 'èƒ½é‡å·®å¼‚è¾ƒå¤§ï¼Œéœ€è¦æ›´å¤šåŒ…å®¹å’Œç†è§£æ‰èƒ½é•¿ä¹…ã€‚'}
            </p>
          </div>
          <div class="detail-section">
            <h4 class="font-bold text-yellow-400 mb-2"><i class="fas fa-briefcase mr-2"></i>äº‹ä¸šåˆä½œå»ºè®®</h4>
            <p class="text-gray-300 text-sm leading-relaxed">
              åœ¨äº‹ä¸šåˆä½œæ–¹é¢ï¼Œ${detail1.trait}çš„${n1}ä¸${detail2.trait}çš„${n2}ï¼Œ${score >= 70 ? 'èƒ½å¤Ÿå½¢æˆè‰¯å¥½çš„äº’è¡¥ï¼Œé€‚åˆå…±åŒåˆ›ä¸šæˆ–åˆä½œé¡¹ç›®ã€‚' : 'åˆä½œä¸­å¯èƒ½å­˜åœ¨åˆ†æ­§ï¼Œå»ºè®®æ˜ç¡®åˆ†å·¥ï¼Œå‘æŒ¥å„è‡ªä¼˜åŠ¿ã€‚'}
            </p>
          </div>
          <div class="detail-section">
            <h4 class="font-bold text-yellow-400 mb-2"><i class="fas fa-lightbulb mr-2"></i>ç›¸å¤„å»ºè®®</h4>
            <p class="text-gray-300 text-sm">${n1}éœ€è¦ï¼š${detail1.advice}<br>${n2}éœ€è¦ï¼š${detail2.advice}</p>
          </div>
        </div>
      `;
      document.getElementById('pair-results').prepend(div);
      Storage.saveHistory({ type: 'pair', p1, p2, n1, n2, score });
      document.getElementById('pair-phone-1').value = ''; document.getElementById('pair-phone-2').value = '';
      document.getElementById('pair-name-1').value = ''; document.getElementById('pair-name-2').value = '';
    }

    // ==================== å¤šäººæ·±åº¦åŒ¹é… ====================
    function addMultiInput() {
      const container = document.getElementById('multi-inputs');
      const count = container.children.length + 1;
      const div = document.createElement('div');
      div.className = 'multi-row flex space-x-3';
      div.innerHTML = `<input type="tel" placeholder="å·ç ${count}" maxlength="13" class="multi-phone flex-1 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400"><input type="text" placeholder="å§“å" class="multi-name w-32 px-4 py-3 rounded-xl bg-gray-900 border border-gray-600 text-white outline-none focus:border-cyan-400"><button onclick="this.parentElement.remove()" class="px-3 py-2 rounded-lg bg-red-500/20 text-red-400">âœ•</button>`;
      container.appendChild(div);
    }
    function analyzeMulti() {
      const phoneInputs = document.querySelectorAll('.multi-phone');
      const nameInputs = document.querySelectorAll('.multi-name');
      const errorEl = document.getElementById('multi-error');
      const users = [];
      for (let i = 0; i < phoneInputs.length; i++) {
        const phone = phoneInputs[i].value.trim().replace(/\D/g, '');
        const name = nameInputs[i].value.trim();
        if (phone && /^1[3-9]\d{9}$/.test(phone)) {
          const dist = analyzeDistribution(extractGroups(phone));
          users.push({ phone, name: name || `ç”¨æˆ·${i+1}`, dist });
          Storage.savePhone(phone, name);
        }
      }
      if (users.length < 3) { errorEl.textContent = 'è¯·è‡³å°‘è¾“å…¥3ä¸ªæœ‰æ•ˆå·ç '; errorEl.classList.remove('hidden'); return; }
      errorEl.classList.add('hidden'); loadQuickFill();
      
      const matches = [];
      for (let i = 0; i < users.length; i++) {
        for (let j = i + 1; j < users.length; j++) {
          const score = calcScore(users[i].dist, users[j].dist);
          matches.push({ u1: users[i], u2: users[j], score });
        }
      }
      matches.sort((a, b) => b.score - a.score);
      
      // æ˜¾ç¤ºæ’è¡Œæ¦œ
      document.getElementById('multi-ranking').classList.remove('hidden');
      document.getElementById('ranking-list').innerHTML = matches.map((m, i) => `
        <div class="flex items-center justify-between p-3 ${i < 3 ? 'bg-yellow-500/10 border border-yellow-500/30' : 'bg-gray-800/50'} rounded-xl">
          <div class="flex items-center space-x-3">
            <span class="w-8 h-8 rounded-full flex items-center justify-center font-bold ${i === 0 ? 'rank-1' : i === 1 ? 'rank-2' : i === 2 ? 'rank-3' : 'bg-gray-700'}">${i + 1}</span>
            <div><div class="font-bold">${m.u1.name} Ã— ${m.u2.name}</div><div class="text-xs text-gray-400">${getScoreLevel(m.score)}</div></div>
          </div>
          <div class="text-right"><div class="text-2xl font-bold" style="color: ${getScoreColor(m.score)}">${m.score}åˆ†</div></div>
        </div>
      `).join('');
      
      // æœ€ä½³é…å¯¹è¯¦æƒ…
      const best = matches[0];
      const div = document.createElement('div');
      div.className = 'glass-card rounded-2xl p-6 mt-4';
      div.innerHTML = `
        <div class="flex justify-between items-start mb-4">
          <h3 class="text-2xl font-bold text-yellow-400"><i class="fas fa-crown mr-2"></i>æœ€ä½³é…å¯¹ç»„åˆ</h3>
          <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-red-400 text-xl">âœ•</button>
        </div>
        <div class="text-center mb-6">
          <div class="text-4xl font-bold text-cyan-400 mb-2">${best.u1.name} Ã— ${best.u2.name}</div>
          <div class="text-6xl font-bold" style="color: ${getScoreColor(best.score)}">${best.score}åˆ†</div>
          <div class="text-xl text-gray-300 mt-2">${getScoreLevel(best.score)}</div>
        </div>
        <div class="bg-gray-800/50 rounded-xl p-4">
          <h4 class="font-bold text-yellow-400 mb-2">å›¢é˜Ÿåˆ†ææ€»ç»“</h4>
          <p class="text-gray-300 text-sm">æœ¬æ¬¡åˆ†æå…± ${users.length} äººï¼Œç”Ÿæˆ ${matches.length} ç»„é…å¯¹ã€‚æœ€ä½³é…å¯¹ä¸º ${best.u1.name} ä¸ ${best.u2.name}ï¼Œå»ºè®®ä¸¤äººåœ¨å›¢é˜Ÿä¸­åŠ å¼ºåˆä½œã€‚</p>
        </div>
      `;
      document.getElementById('multi-results').prepend(div);
      Storage.saveHistory({ type: 'multi', count: users.length, best: best.score });
    }

    // ==================== å†å²è®°å½• ====================
    function loadHistory() {
      const history = Storage.getHistory();
      const container = document.getElementById('history-list');
      if (history.length === 0) { container.innerHTML = '<p class="text-gray-500 text-center py-8">æš‚æ— å†å²è®°å½•</p>'; return; }
      container.innerHTML = history.slice(0, 20).map(h => {
        const date = new Date(h.date).toLocaleString('zh-CN', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        if (h.type === 'single') return `<div class="star-card rounded-xl p-4"><div class="flex justify-between"><span class="text-cyan-400">å•äººæ·±åº¦åˆ†æ</span><span class="text-gray-400 text-sm">${date}</span></div><div class="mt-1">****${h.phone.slice(-4)} â†’ ${h.result}</div></div>`;
        else if (h.type === 'pair') return `<div class="star-card rounded-xl p-4"><div class="flex justify-between"><span class="text-yellow-400">åŒäººåŒ¹é…</span><span class="text-gray-400 text-sm">${date}</span></div><div class="mt-1" style="color: ${getScoreColor(h.score)}">${h.n1} Ã— ${h.n2} = ${h.score}åˆ†</div></div>`;
        else return `<div class="star-card rounded-xl p-4"><div class="flex justify-between"><span class="text-purple-400">å¤šäººåŒ¹é…</span><span class="text-gray-400 text-sm">${date}</span></div><div class="mt-1">${h.count}äººå‚ä¸ï¼Œæœ€ä½³ ${h.best}åˆ†</div></div>`;
      }).join('');
    }

    // ==================== æ ‡ç­¾åˆ‡æ¢ ====================
    function switchTab(tab) {
      ['single', 'pair', 'multi', 'history'].forEach(t => { document.getElementById('panel-' + t).classList.add('hidden'); document.getElementById('tab-' + t).classList.remove('tab-active'); document.getElementById('tab-' + t).classList.add('tab-inactive'); });
      document.getElementById('panel-' + tab).classList.remove('hidden');
      document.getElementById('tab-' + tab).classList.remove('tab-inactive');
      document.getElementById('tab-' + tab).classList.add('tab-active');
      if (tab === 'history') loadHistory();
    }
  </script>
</body>
</html>
