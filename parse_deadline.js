// 解析日期并转换为时间戳（毫秒）
function parseDeadline(text, recordNumber) {
  // 跳过循环/持续任务
  const skipPatterns = ['持续', '循环', '每', '自动'];
  for (const pattern of skipPatterns) {
    if (text.includes(pattern)) {
      return null;
    }
  }
  
  // 尝试多种日期格式匹配
  const patterns = [
    // 标准格式: 截止：2026-02-18
    /截止[:：]\s*(\d{4})-(\d{2})-(\d{2})/,
    // 格式: 2月14日(周五) 或 2月14日
    /(\d{1,2})月(\d{1,2})日/,
    // 格式: 截止：2月28日
    /截止[:：]\s*(\d{1,2})月(\d{1,2})日/,
    // 项目截止: 2026-05-01上线
    /项目截止[:：]\s*(\d{4})-(\d{2})-(\d{2})/,
    // Q1截止: 2026-03-31
    /Q\d+截止[:：]\s*(\d{4})-(\d{2})-(\d{2})/,
    // 阶段截止: 2026-03-31
    /阶段截止[:：]\s*(\d{4})-(\d{2})-(\d{2})/,
    // 决策截止: 2月28日
    /决策截止[:：]\s*(\d{1,2})月(\d{1,2})日/,
  ];
  
  for (const pattern of patterns) {
    const match = text.match(pattern);
    if (match) {
      let year, month, day;
      
      if (match[0].includes('2026')) {
        year = parseInt(match[1]);
        month = parseInt(match[2]) - 1; // JS月份从0开始
        day = parseInt(match[3]);
      } else {
        year = 2026; // 默认当前年份
        month = parseInt(match[1]) - 1;
        day = parseInt(match[2]);
      }
      
      // 创建日期对象（设置为当天结束时 23:59:59）
      const date = new Date(year, month, day, 23, 59, 59);
      return date.getTime();
    }
  }
  
  console.log(`记录 ${recordNumber}: 未找到日期格式`);
  return null;
}

// 所有记录数据
const records = [
  { id: "recvaQjZYyo7rs", number: "1", text: "【八星数字性格分析工具】调研八星数字学理论体系\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-02-18\n备注：需购买课程/书籍，学习核心算法基础" },
  { id: "recvaQk1zkVLSk", number: "2", text: "【公众号运营】第3期文章撰写\n项目：公众号运营 | 优先级：P0 | 状态：待开始 | 截止：2026-02-14\n备注：周二发布，原创深度文" },
  { id: "recvaQk3gOlUO1", number: "3", text: "【八星数字性格分析工具】确定技术方案\n项目：工具开发 | 优先级：P0 | 状态：待决策 | 截止：2026-03-15\n备注：微信小程序 vs H5 vs 小程序+后端" },
  { id: "recvaQk4LSYCaU", number: "4", text: "【道家修炼】每日导引吐纳练习\n项目：道家修炼 | 优先级：P1 | 状态：进行中 | 截止：持续\n备注：早晚各一次，每次30分钟" },
  { id: "recvaQldaqIaWn", number: "5", text: "【八星数字性格分析工具】收集市面上类似工具参考\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-02-15\n备注：生命灵数、数字密码等竞品分析" },
  { id: "recvaQlduAM1CT", number: "6", text: "【八星数字性格分析工具】整理手机号码分析方法\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-02-20\n备注：核心算法基础" },
  { id: "recvaQldOtuBCU", number: "7", text: "【八星数字性格分析工具】确定算法逻辑（数字→性格特征）\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-02-25\n备注：需要专业知识" },
  { id: "recvaQle7MsNB4", number: "8", text: "【八星数字性格分析工具】功能需求文档（PRD）\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-03-05\n备注：产品功能定义" },
  { id: "recvaQlepjz2oo", number: "9", text: "【八星数字性格分析工具】核心算法开发\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-03-25\n备注：数字解析逻辑" },
  { id: "recvaQleIQ27lJ", number: "10", text: "【公众号运营】每周二文章发布\n项目：公众号运营 | 优先级：P0 | 状态：循环 | 截止：每周二23:00\n备注：原创深度文" },
  { id: "recvaQlf2YYzBk", number: "11", text: "【公众号运营】每周五文章发布\n项目：公众号运营 | 优先级：P0 | 状态：循环 | 截止：每周五23:00\n备注：疗愈工具/案例" },
  { id: "recvaQlfmuXtUV", number: "12", text: "【公众号运营】每周日文章发布\n项目：公众号运营 | 优先级：P0 | 状态：循环 | 截止：每周日23:00\n备注：互动/问答" },
  { id: "recvaQlfFLS51S", number: "13", text: "【公众号运营】粉丝增长策略执行\n项目：公众号运营 | 优先级：P1 | 状态：进行中 | 截止：持续\n备注：日常运营" },
  { id: "recvaQlfYOBGva", number: "14", text: "【道家修炼】寻找明师指导\n项目：道家修炼 | 优先级：P0 | 状态：待开始 | 截止：2026-02-28\n备注：线下或线上" },
  { id: "recvaQlgigxLxv", number: "15", text: "【道家修炼】《黄庭经》研读\n项目：道家修炼 | 优先级：P1 | 状态：进行中 | 截止：2026-03-31\n备注：内丹基础经典" },
  { id: "recvaQlgCsIncV", number: "16", text: "【系统运维】模型余额监控\n项目：系统维护 | 优先级：P1 | 状态：自动运行 | 截止：持续\n备注：每小时检查" },
  { id: "recvaQlh4a6wYk", number: "17", text: "【系统运维】用量报告生成\n项目：系统维护 | 优先级：P2 | 状态：自动运行 | 截止：每日8点\n备注：已配置" },
  { id: "recvaQlpiblCui", number: "18", text: "【八星数字性格分析工具】小程序注册与审核\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-04-28\n备注：需要企业资质" },
  { id: "recvaQlpDSKbT0", number: "19", text: "【八星数字性格分析工具】部署上线\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-05-01\n备注：正式发布" },
  { id: "recvaQlpWPrqEZ", number: "20", text: "【公众号运营】30天允许练习表优化\n项目：公众号运营 | 优先级：P1 | 状态：待开始 | 截止：2026-02-20\n备注：互动工具改进" },
  { id: "recvaQlqfZ5XMT", number: "21", text: "【公众号运营】社群建立\n项目：公众号运营 | 优先级：P1 | 状态：待开始 | 截止：2026-03-01\n备注：粉丝互动群" },
  { id: "recvaQlqApCdnr", number: "22", text: "【八星数字性格分析工具】产品原型设计\n项目：工具开发 | 优先级：P1 | 状态：待开始 | 截止：2026-03-10\n备注：UI/UX设计" },
  { id: "recvaQlr9wpa0C", number: "23", text: "【八星数字性格分析工具】匹配度计算模块\n项目：工具开发 | 优先级：P1 | 状态：待开始 | 截止：2026-03-30\n备注：人际匹配算法" },
  { id: "recvaQlrsEp5k1", number: "24", text: "【八星数字性格分析工具】功能测试\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-04-15\n备注：全面测试" },
  { id: "recvaQlrMe5Udh", number: "25", text: "【道家修炼】修炼社群加入\n项目：道家修炼 | 优先级：P1 | 状态：待开始 | 截止：2026-03-15\n备注：交流心得" },
  { id: "recvaQls5CWSuk", number: "26", text: "【系统运维】飞书连接检查\n项目：系统维护 | 优先级：P1 | 状态：自动运行 | 截止：每2小时\n备注：已配置" },
  { id: "recvaQlsoFyO3p", number: "27", text: "【八星数字性格分析工具】运营推广计划\n项目：工具开发 | 优先级：P1 | 状态：待开始 | 截止：2026-05-05\n备注：上线后推广" },
  { id: "recvaQlsI1lff8", number: "28", text: "【八星数字性格分析工具】前端界面开发\n项目：工具开发 | 优先级：P1 | 状态：待开始 | 截止：2026-04-05\n备注：页面实现" },
  { id: "recvaQlt20yb8Z", number: "29", text: "【八星数字性格分析工具】搭建开发环境\n项目：工具开发 | 优先级：P0 | 状态：待开始 | 截止：2026-03-18\n备注：需要开发者账号" },
  { id: "recvaQm0p1ipVe", number: "30", text: "【项目总览】八星数字性格分析工具\n📅项目截止：2026-05-01上线 | 当前进度：0% | 状态：🔴启动期\n任务数：15 | 当前阶段：阶段一需求调研\n\n🎯关键里程碑：\n• 2/18 理论调研完成\n• 3/15 技术方案确定\n• 5/01 正式上线\n\n⚠️风险：技术方案未确定、开发资源不明确\n⏰提醒：每日自动同步进度" },
  { id: "recvaQm0LHXtVm", number: "31", text: "【项目总览】疗愈师阿慶公众号运营\n📅Q1截止：2026-03-31 | 当前进度：30% | 状态：🟢稳定运营\n任务数：7 | 本周重点：第3期文章撰写(2/14周五)\n\n🎯近期截止：\n• 2/14 第3期文章发布（周五23:00）\n• 2/16 第4期文章发布（周日23:00）\n• 2/18 理论调研完成（工具项目）\n\n🎯Q1目标：粉丝+50人，保持每周3更\n⏰提醒：每日早8点简报，每周日晚复盘" },
  { id: "recvaQm1etnOvk", number: "32", text: "【项目总览】道家修炼计划\n📅阶段截止：2026-03-31 | 当前进度：进行中 | 状态：🟢日常修炼\n任务数：4 | 当前阶段：坚持每日修炼\n\n🎯关键里程碑：\n• 2/28 找到明师指导\n• 3/15 加入修炼社群\n• 3/31 功法笔记整理\n\n⚠️风险：明师尚未找到\n⏰提醒：每日检查修炼打卡，里程碑前3天预警" },
  { id: "recvaQm1xzb3C5", number: "33", text: "【项目总览】OpenClaw系统维护\n📅Q1评估：2026-03-31 | 当前进度：90% | 状态：🟢稳定运行\n任务数：3 | 当前阶段：全自动化运维\n\n🎯运行状态：\n• 模型余额监控：每小时自动✅\n• 飞书连接检查：每2小时自动✅\n• 用量报告生成：每日8点自动✅\n\n🎯Q1目标：保持100%正常运行，成本控制在¥50内\n⏰提醒：每日自动监控，异常立即告警" },
  { id: "recvaQm59UrDuD", number: "34", text: "【本周重点P0】第3期文章撰写\n📅截止：2月14日(周五) 23:00发布\n所属项目：公众号运营 | 状态：🔴初稿完成待修改\n\n✅已完成：虾哥初稿529字\n⏳待完成：阿慶修改→排版→发布\n\n⏰提醒：2月13日前完成修改，2月14日晚23:00定时发布" },
  { id: "recvaQm5uOQZPm", number: "35", text: "【本周重点P0】八星数字理论调研\n📅截止：2月18日(周二)\n所属项目：工具开发 | 状态：🔴未开始\n\n⏳待完成：购买课程→学习理论→整理笔记\n\n⚠️依赖：调研完成才能进入产品设计阶段\n⏰提醒：2月15日前购买课程，2月18日前完成学习" },
  { id: "recvaQm5OAdadx", number: "36", text: "【风险预警🔴】技术方案未确定\n⏰决策截止：2月28日\n所属项目：工具开发 | 风险等级：高\n\n⚠️影响：整个开发计划受阻，无法进入开发阶段\n🎯待决策：微信小程序 vs H5网页 vs 小程序+后端\n\n⏰提醒：2月25日前必须初步确定，2月28日最终决策\n💡建议：可先调研竞品技术方案，咨询开发者意见" },
  { id: "recvaQm67SpDqs", number: "37", text: "【风险预警🟡】明师未找到\n⏰截止：2月28日\n所属项目：道家修炼 | 风险等级：中\n\n⚠️影响：修炼缺乏指导，可能走弯路\n🎯行动：线上线下多渠道寻找\n\n⏰提醒：2月20日检查进度，2月25日前确定人选\n💡建议：可先加入线上社群，边练边找" }
];

// 解析所有记录
const results = [];
for (const record of records) {
  const timestamp = parseDeadline(record.text, record.number);
  results.push({
    record_id: record.id,
    number: record.number,
    timestamp: timestamp,
    shouldUpdate: timestamp !== null
  });
}

// 输出结果
console.log(JSON.stringify(results, null, 2));
